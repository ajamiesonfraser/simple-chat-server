<html>

<!-- This is the heading -->
  <head>

<!-- This is the title -->
    <title>A.J.'s Chat UI</title>

<!-- Link to my css stylesheet -->
    <link type="text/css" rel="stylesheet" href="style.css" />
  </head>
 
<!-- Body of the Chat -->
  <body>

<!-- This is the entirety of my Chat UI-->
    <div id="everything">

  

    <!-- Menu "A.J.'s Chat UI" -->
      <div id="menu">
        <p class="title">A.J.'s UIT Chat UI <b></b></p>
        <div style="clear:both"></div>
      </div> 
      
      <div style+"float:left;width:75px;border-right:1px solid black;height;100px;padding:10px;overflow:scroll-y;">
        <div id="users"></div>
      </div>
    
      <div id="chat_window">
        
    <!-- This is the white box where the chat text appears -->
          <div id="conversation"></div>
        
          <div id="userInput">
            <input id="data" style="width:200px;" autofocus="autofocus"/>
            <input type="button" id="datasend" value="Send" />
          </div>
        </div>

        </div>
    
    </div>

    <!-- These are scripts calling for socket.io and jquery library -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js">
    </script>
    <script src="index.js"></script>
    
    <!-- This is socket script for grabbing text and appending it to the chatlog -->
    <script>
      var URL = window.location.protocol + "//" + window.location.host;
        console.log("Connecting to " + URL);
      var socket = io.connect(URL);
      var keywords = [{word:"redis",annote:"im redis annote"},{word:"socket.io",annote:"im socket.io annote"},{word:"node",annote:"im node annote"}]
      var displayQuery = function(annotation) {
        alert(annotation);
        console.log(annotation);  

      }
      var username="";
        // on connection to server, ask for user's name with an anonymous callback
      socket.on('connect', function(){
                // call the server-side function 'adduser' and send one parameter (value of prompt)
        username = prompt("Whats your name?")
        socket.emit('adduser', username);

        });
 
        // listener, whenever the server emits 'updatechat', this updates the chat body
      socket.on('updatechat', function (data) {
        $('#conversation').append(data + '<br>');
      });
 
        // listener, whenever the server emits 'updateusers', this updates the username list
      socket.on('updateusers', function(data) {
        $('#users').empty();
        $.each(data, function(key, value) {
          $('#users').append('<div>' + key + '</div>');
        });
      });

      // appends databased message from server to the chat box on client side
      socket.on('history', function (data) {
        $('#conversation').append('<div>'+ data + '<div>');
      });
 
      $(function(){
        // This submits chat message when clicking Send button
        $('#datasend').click( function() {
          var message = $('#data').val();

          message = message.replace(/</,"!");
          message = message.replace(/>/,"!");
          message = '<b>'+username + ':</b> '+message;
          keywords.forEach(function(keyword){
            console.log("msg:",message);
              
            if(message.search(keyword.word)>-1){
              console.log("keyword",JSON.stringify(keyword));

              var regex = RegExp(keyword.word);
              console.log("regex:",regex);
              message = message.replace(regex,"<div style=\'background:red; display:inline;\'onclick='displayQuery("+"\""+keyword.annote+"\""+")'>"+keyword.word+"</div>")
              console.log(message);
            }
          })
          /* var annote = "whatever";
          /* message = message.replace (/redis/g,"<div onclick='displayQuery("+"\""+annote+"\""+")'>"+'redis'+"</div>") */
          document.getElementById('data').focus();
          $('#data').val('');
           // Gets server to execute sendchat
          socket.emit('sendchat', message);
        });
 
        // This submits chat massage upon clicking ENTER key
        $('#data').keypress(function(e) {
          if(e.which == 13) {
            $(this).blur();
            $('#datasend').focus().click();
          }
        });
      });
    </script>

  </body>

</html>